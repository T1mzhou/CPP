# 55.经典问题解析四



![Slide1](55.经典问题解析四.assets/Slide1.PNG)



![Slide2](55.经典问题解析四.assets/Slide2.PNG)



![Slide3](55.经典问题解析四.assets/Slide3.PNG)

**面试问题：为什么new是关键字？**->核心在于构造和析构



![Slide4](55.经典问题解析四.assets/Slide4.PNG)

**第一步申请对空间-》第二部在堆空间上面进行调用构造**

![Slide5](55.经典问题解析四.assets/Slide5.PNG)

```cpp
#include <iostream>
#include <string>
#include <cstdlib>

using namespace std;

class Test
{
    int* mp;
public:
    Test()
    {
        cout << "Test::Test()" << endl;
        
        mp = new int(100);
        
        cout << *mp << endl;
    }
    ~Test()
    {
        delete mp;
        
        cout << "~Test::Test()" << endl;
    }
};

int main()
{
    Test* pn = new Test;
    Test* pm = (Test*)malloc(sizeof(Test));
    
    delete pn;
    free(pm);
    
    return 0;
}

```

**使用C语言不能进行动态内存分配;**

**但是使用c++肯定可以对内存进行分配；new是关键字所以原生支持；**![Slide6](55.经典问题解析四.assets/Slide6.PNG)

**对象得创建只能用new因为需要调用构造函数**

![Slide7](55.经典问题解析四.assets/Slide7.PNG)

**不要混用，会出现很多问题**

![Slide8](55.经典问题解析四.assets/Slide8.PNG)

 

![Slide9](55.经典问题解析四.assets/Slide9.PNG)



![Slide10](55.经典问题解析四.assets/Slide10.PNG)



![Slide11](55.经典问题解析四.assets/Slide11.PNG)

```cpp
#include <iostream>
#include <string>

using namespace std;

class Base
{
public:
    Base()
    {
        cout << "Base()" << endl;
        
        func();
    }
    
    virtual void func() 
    {
        cout << "Base::func()" << endl;
    }
    
    virtual ~Base()
    {
        func();
        
        cout << "~Base()" << endl;
    }
};


class Derived : public Base
{
public:
    Derived()
    {
        cout << "Derived()" << endl;
        
        func();
    }
    
    virtual void func()
    {
        cout << "Derived::func()" << endl;
    }
    
    ~Derived()
    {
        func();
        
        cout << "~Derived()" << endl;
    }
};


int main()
{
    Base* p = new Derived();
    
    // ...
    
    delete p;
    
    return 0;
}

```

![Slide12](55.经典问题解析四.assets/Slide12.PNG)



![Slide13](55.经典问题解析四.assets/Slide13.PNG)



![Slide14](55.经典问题解析四.assets/Slide14.PNG)



![Slide15](55.经典问题解析四.assets/Slide15.PNG)



![Slide16](55.经典问题解析四.assets/Slide16.PNG)



![Slide17](55.经典问题解析四.assets/Slide17.PNG)



![Slide18](55.经典问题解析四.assets/Slide18.PNG)

```cpp
#include <iostream>
#include <string>

using namespace std;

class Base
{
public:
    Base()
    {
        cout << "Base::Base()" << endl;
    }
    
    virtual ~Base()
    {
        cout << "Base::~Base()" << endl;
    }
};

class Derived : public Base
{

};

int main()
{
    Base* p = new Base;
    
    Derived* pd = dynamic_cast<Derived*>(p);
    
    if( pd != NULL )
    {
        cout << "pd = " << pd << endl;
    }
    else
    {
        cout << "Cast error!" << endl;
    }
    
    delete p;
    
    return 0;
}


```

![Slide19](55.经典问题解析四.assets/Slide19.PNG)